# 競馬予想ソフト 完全説明書

## 概要

### このソフトについて
**競馬予想システム v3.0** は、7ファイル構成のシンプルで高精度な競馬予想ソフトです。ワンクリックで予想が完了し、個人のローカル環境での使用に最適化されています。

### 主な特徴
- [OK] **ワンクリック実行**: main.pyを実行するだけで予想完了
- [OK] **6要素評価システム**: 高精度な馬の評価
- [OK] **並列処理**: ThreadPoolExecutorで高速処理
- [OK] **フォールバック機能**: エラー時も動作継続
- [OK] **設定外部化**: config.jsonで簡単カスタマイズ

---

## 使い方（超簡単）

### 1. 基本的な使い方
```bash
python main.py
```
これだけで予想が完了します！

### 2. 実行結果の見方
```
* 本命: 14番 セナスタイル
   * オッズ: 29.5倍 | * 評価: 74.5点
   * 騎手: 田中騎手 | * 体重: 55.0

* 対抗: 16番 コンドゥイア  
   * オッズ: 106.4倍 | * 評価: 72.33点

* 穴馬: 12番 マトリコーニッシュ
   * オッズ: 80.8倍 | * 評価: 68.41点
```

**読み方**:
- **本命**: 1着候補（最も信頼できる馬）
- **対抗**: 2着候補（本命に次ぐ有力馬）
- **穴馬**: 高配当候補（大穴を狙える馬）

---

## ファイル構成

### 7つのファイル構成
```
競馬予想ソフト/
├── main.py              # ←これを実行！
├── config.json          # 設定ファイル
├── data_loader.py       # データ読み込み
├── horse_evaluator.py   # 馬評価システム
├── betting_strategy.py  # 購入戦略
├── output_formatter.py  # 結果出力
├── utils.py            # 共通機能
└── data/               # レースデータ
    └── race_data_*.json
```

### 各ファイルの役割

#### main.py（メイン実行ファイル）
- **役割**: ワンクリックで予想を実行
- **使い方**: `python main.py`で実行
- **処理**: データ読み込み→評価→結果出力

#### config.json（設定ファイル）
- **役割**: 重み付けや表示数などの設定
- **カスタマイズ可能項目**:
  - 評価重み付け（過去成績30%、コース適正35%など）
  - 表示馬数（デフォルト3頭）
  - 予算設定

#### horse_evaluator.py（評価システム）
- **役割**: 6要素で馬を評価
- **評価項目**:
  1. 過去成績（30%）
  2. コース適正（35%）
  3. オッズ価値（15%）
  4. 前走間隔（10%）
  5. 穴馬要素（10%）
  6. 近走傾向（新機能）

---

## 設定のカスタマイズ

### config.jsonの主要設定

#### 評価重み付けの変更
```json
"horse_evaluation": {
  "weights": {
    "past_performance": 0.30,    # 過去成績の重み
    "course_fit": 0.35,          # コース適正の重み
    "odds_value": 0.15,          # オッズ価値の重み
    "interval_score": 0.10,      # 前走間隔の重み
    "dark_horse_potential": 0.10  # 穴馬要素の重み
  }
}
```

#### 表示設定の変更
```json
"system_settings": {
  "display_horse_count": 3      # 表示する馬数（1-5推奨）
}
```

#### 予算設定の変更
```json
"betting_strategy": {
  "total_budget": 1000,        # 総予算（円）
  "min_bet_unit": 100          # 最小賭け単位（円）
}
```

---

## [高度] 高度な使い方

### 1. レースデータの変更
新しいレースを予想する場合：

1. `data/`フォルダに新しいJSONファイルを配置
2. `config.json`の`data_file`を変更
```json
"data_file": "data/race_data_20251201_japan_cup.json"
```

### 2. エラー時の対処法

#### ファイルが見つからない場合
```
[ERROR] 必要なファイルが見つかりません: config.json
  確認事項: config.json, race_dataが存在するか
```
**対処法**: config.jsonとレースデータファイルの存在を確認

#### JSON形式エラーの場合
```
[ERROR] JSON形式が不正です
  確認事項: データファイルの構文エラー
```
**対処法**: JSONファイルの構文を確認（カンマ、括弧の対応など）

#### モジュール不足の場合
```
[ERROR] 必要なモジュールがありません
  対処法: pip install -r requirements.txt
```
**対処法**: 必要なライブラリをインストール

### 3. フォールバック機能
データに問題があっても、システムが自動でダミーデータを生成して動作を継続します。

---

## [分析] 評価システムの詳細

### 6要素評価システム

#### 1. 過去成績（30%）
- **何を評価**: 最近のレース結果と着差
- **高評価条件**: 連続上位入賞、小さな着差での負け
- **重要度**: 最重要項目の一つ

#### 2. コース適正（35%）
- **何を評価**: 距離・コース・競馬場との相性
- **高評価条件**: 同条件での好成績、得意距離
- **重要度**: 最重要項目

#### 3. オッズ価値（15%）
- **何を評価**: 能力に対するオッズの妥当性
- **高評価条件**: 実力の割にオッズが高い
- **重要度**: 穴馬発見に重要

#### 4. 前走間隔（10%）
- **何を評価**: 前回のレースからの間隔
- **高評価条件**: 適度な休養（2-8週間程度）
- **重要度**: 体調面の指標

#### 5. 穴馬要素（10%）
- **何を評価**: 高配当の可能性
- **高評価条件**: 高オッズでも潜在能力あり
- **重要度**: 大穴狙いに重要

#### 6. 近走傾向（新機能）
- **何を評価**: 最近3走の着順変化
- **高評価条件**: 着順が改善傾向
- **重要度**: 調子の上向きを検出

---

## [推奨] 購入ガイド機能

### シンプル購入ガイド
```
予算1000円での推奨購入:
単勝 14番: 333円
馬連 14-16: 333円  
ワイド 14-12: 334円
```

### 詳細購入ガイド
- 戦略タイプ別の推奨購入パターン
- 期待リターン倍率の計算
- リスク分散のアドバイス

---

## [問題解決] トラブルシューティング

### よくある問題と解決法

#### Q1. 予想結果が表示されない
**原因**: レースデータの形式問題
**解決法**: 
1. レースデータファイルの存在確認
2. JSON形式の確認
3. 馬データの必須項目確認（name, number, odds）

#### Q2. 処理が遅い・止まる
**原因**: 大量データまたはメモリ不足
**解決法**:
1. 不要なファイルの削除
2. Pythonの再起動
3. レースデータの馬数を減らす

#### Q3. エラーで止まる
**原因**: 設定ファイルの問題
**解決法**:
1. config.jsonの構文確認
2. デフォルト設定に戻す
3. data_loaderのフォールバック機能が作動

#### Q4. 予想精度が低い
**原因**: 重み付けが競馬場・レースに合わない
**解決法**:
1. config.jsonの重み付け調整
2. 過去データでの検証
3. コース適正の重み増加

---

## [安全] 安全機能

### 組み込み済み安全機能
- **パストラバーサル攻撃防止**: ファイルアクセスの安全性確保
- **SQLインジェクション防止**: データベース操作の安全性
- **入力データ検証**: 不正データの自動除去
- **エラーハンドリング**: 詳細なエラー情報と対処法表示
- **フォールバック機能**: 障害時の自動復旧

---

## [性能] パフォーマンス

### 処理速度
- **目標**: 5-10分以内での予想完了
- **実績**: 18頭の評価を約1-2分で完了
- **最適化**: ThreadPoolExecutor並列処理使用

### メモリ使用量
- **軽量設計**: 最小限のメモリ使用
- **自動クリーンアップ**: 不要データの自動削除
- **キャッシュ機能**: 頻繁なデータアクセスの高速化

---

## [設定] カスタマイズ例

### 1. 穴馬重視の設定
```json
"weights": {
  "past_performance": 0.20,
  "course_fit": 0.25,
  "odds_value": 0.25,
  "interval_score": 0.10,
  "dark_horse_potential": 0.20
}
```

### 2. 堅実派の設定
```json
"weights": {
  "past_performance": 0.40,
  "course_fit": 0.40,
  "odds_value": 0.05,
  "interval_score": 0.10,
  "dark_horse_potential": 0.05
}
```

### 3. 表示数を増やす
```json
"system_settings": {
  "display_horse_count": 5
}
```

---

## [ログ] ログファイル

### ログの確認方法
- **場所**: `logs/keiba_system.log`
- **内容**: 実行履歴、エラー詳細、デバッグ情報
- **活用法**: トラブル時の原因調査

### ログの見方
```
2025-09-28 00:04:02 - INFO - 競馬予想システム v3.0 - ワンクリック実行開始
2025-09-28 00:04:02 - INFO - レースデータ読み込み: 第43回 阪神競馬場ローズステークス
2025-09-28 00:04:02 - INFO - 評価完了: 18頭
```

---

## まとめ

### このソフトの強み
1. **シンプル**: ワンクリックで予想完了
2. **高精度**: 6要素評価システム
3. **安全**: 多重エラーハンドリング
4. **カスタマイズ可能**: 設定で好みに調整
5. **軽量**: 個人PC環境に最適

### 推奨使用方法
1. まずはデフォルト設定で動作確認
2. 結果を見て重み付けを微調整
3. 自分の競馬スタイルに合わせてカスタマイズ
4. ログを確認して動作状況を把握

### 購入時の注意
**重要**: このソフトは予想の参考情報を提供するものです。実際の購入判断と責任は利用者にあります。競馬は不確実性の高い娯楽であることを理解の上、余裕資金の範囲内で楽しんでください。

---

## サポート

### 問題が発生した場合
1. **ログファイルの確認**: `logs/keiba_system.log`
2. **設定の初期化**: config.jsonをデフォルトに戻す
3. **動作テスト**: 簡単なレースデータで動作確認

### バージョン情報
- **現在のバージョン**: v3.0
- **ファイル構成**: 7ファイル構成
- **最終更新**: 2025年9月
- **対応環境**: Windows 10/11, Python 3.8+

---

*このソフトウェアは個人使用向けに開発されました。予想は参考情報として活用し、実際の購入は自己責任で行ってください。競馬は適度に楽しみましょう。*
